<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tradelogpro - Professional Trading Journal</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
tailwind.config = {
darkMode: 'class',
theme: {
extend: {
colors: {
darkBg: '#1a1b1e',
darkCard: '#25262b',
darkText: '#c1c2c5',
darkBorder: '#373a40'
}
}
}
}
</script>
<script>
// --- CONSTANTS AND SETTINGS ---

const MONTHS_RU = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
const DAYS_OF_WEEK_RU = ["Mo", "Tu", "We", "Th", "Fr", "Sa", "Su"];
// Storage keys
const STORAGE_KEY = 'tradelogProData_v2';
const OLD_STORAGE_KEY = 'tradingCalendarLocalDeals'; 
const THEME_KEY = 'tradelogProTheme';
let selectedDate = new Date();
let currentYear = selectedDate.getFullYear();
let currentMonth = selectedDate.getMonth();

// Data Structure: { 'YYYY-MM-DD': [ {id, instrument, amount, type, ...} ] }
let dealsData = {};
let editingDealId = null;
// Chart variables
let equityChartInstance = null;
let winrateChartInstance = null;

// --- UTILS ---
const formatDate = (date) => {
const y = date.getFullYear();
const m = String(date.getMonth() + 1).padStart(2, '0');
const d = String(date.getDate()).padStart(2, '0');
return `${y}-${m}-${d}`;
};
const generateId = () => crypto.randomUUID();

// --- STORAGE & THEME ---
const loadData = () => {
const stored = localStorage.getItem(STORAGE_KEY);
if (stored) {
try {
dealsData = JSON.parse(stored);
} catch (e) {
console.error("Data load error", e);
dealsData = {};
}
}
};

const migrateOldData = () => {
const oldData = localStorage.getItem(OLD_STORAGE_KEY);
if (oldData) {
try {
const parsedOld = JSON.parse(oldData);
let restoredCount = 0;
if (Array.isArray(parsedOld)) {
parsedOld.forEach(oldDeal => {
const date = oldDeal.date;
if (!dealsData[date]) dealsData[date] = [];
const exists = dealsData[date].some(d => d.id === oldDeal.id || (d.amount == oldDeal.amount && d.description === oldDeal.description));

if (!exists) {
dealsData[date].push({
...oldDeal,
id: oldDeal.id || generateId(),
type: oldDeal.type || 'profit',
direction: oldDeal.direction || 'long',
timestamp: oldDeal.timestamp || new Date().toISOString()
});
restoredCount++;
}
});
}
if (restoredCount > 0) {
saveData();
showTemporaryMessage(`Restored ${restoredCount} trades from old version!`, 'green');
}
} catch (e) {
console.error("Migration error", e);
}
}
};

const saveData = () => {
localStorage.setItem(STORAGE_KEY, JSON.stringify(dealsData));
updateAnalytics();
};

const initTheme = () => {
const savedTheme = localStorage.getItem(THEME_KEY);
const html = document.documentElement;
if (savedTheme === 'dark') {
html.classList.add('dark');
} else {
html.classList.remove('dark');
}
};

const toggleTheme = () => {
const html = document.documentElement;
html.classList.toggle('dark');
const isDark = html.classList.contains('dark');
localStorage.setItem(THEME_KEY, isDark ? 'dark' : 'light');
updateAnalytics();
};

// --- BUSINESS LOGIC ---
const calculateRR = () => {
const risk = parseFloat(document.getElementById('deal-risk').value) || 0;
const reward = parseFloat(document.getElementById('deal-reward').value) || 0;
const rrDisplay = document.getElementById('rr-display');

if (risk > 0 && reward > 0) {
const ratio = (reward / risk).toFixed(1);
rrDisplay.textContent = `1:${ratio}`;
rrDisplay.className = ratio >= 2 ? 'text-green-500 font-bold ml-2' : 'text-yellow-500 font-bold ml-2';
} else {
rrDisplay.textContent = '-';
rrDisplay.className = 'text-gray-400 ml-2';
}
};

// --- EXPORT / IMPORT ---
const exportToCSV = () => {
const allDeals = Object.values(dealsData).flat();
if (allDeals.length === 0) {
showTemporaryMessage('No data to export', 'red');
return;
}
let csvContent = "data:text/csv;charset=utf-8,";
csvContent += "Date,Time,Instrument,Type,Direction,Amount,Risk,Reward,Strategy,Emotion,Description,Screenshot\n";
allDeals.forEach(deal => {
const dateObj = new Date(deal.timestamp);
const date = deal.date;
const time = dateObj.toLocaleTimeString();
const desc = deal.description ? `"${deal.description.replace(/"/g, '""')}"` : "";

const row = [
date, time, deal.instrument, deal.type, deal.direction,
deal.amount, deal.risk || 0, deal.reward || 0,
deal.strategy || "", deal.emotion || "", desc, deal.screenshot || ""
].join(",");
csvContent += row + "\n";
});
const encodedUri = encodeURI(csvContent);
const link = document.createElement("a");
link.setAttribute("href", encodedUri);
link.setAttribute("download", `tradelog_export_${formatDate(new Date())}.csv`);
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
};

const importBackup = (event) => {
const file = event.target.files[0];
if (!file) return;
const reader = new FileReader();
reader.onload = (e) => {
try {
const content = e.target.result;
const parsed = JSON.parse(content);
if (confirm(`Records found. This will overwrite current data. Continue?`)) {
dealsData = parsed;
saveData();
initApp();
showTemporaryMessage('Data successfully imported!', 'green');
}
} catch (err) {
showTemporaryMessage('Error: .json file required', 'red');
}
};
reader.readAsText(file);
};

const exportBackupJSON = () => {
const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(dealsData));
const downloadAnchorNode = document.createElement('a');
downloadAnchorNode.setAttribute("href", dataStr);
downloadAnchorNode.setAttribute("download", "tradelog_backup.json");
document.body.appendChild(downloadAnchorNode);
downloadAnchorNode.click();
downloadAnchorNode.remove();
}

// --- ANALYTICS ---
const updateAnalytics = () => {
const allDeals = Object.values(dealsData).flat().sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

const labels = [];
const dataPoints = [];
let cumulative = 0;
let winCount = 0;
let lossCount = 0;
allDeals.forEach(deal => {
const val = parseFloat(deal.amount);
if (deal.type === 'profit') {
cumulative += val;
winCount++;
} else {
cumulative -= val;
lossCount++;
}
const dateShort = deal.date.substring(5); // MM-DD
labels.push(dateShort);
dataPoints.push(cumulative);
});
const isDark = document.documentElement.classList.contains('dark');
const gridColor = isDark ? '#373a40' : '#e5e7eb';
const textColor = isDark ? '#c1c2c5' : '#4b5563';
const ctxEquity = document.getElementById('equityChart').getContext('2d');
if (equityChartInstance) equityChartInstance.destroy();
equityChartInstance = new Chart(ctxEquity, {
type: 'line',
data: {
labels: labels,
datasets: [{
label: 'Equity ($)',
data: dataPoints,
borderColor: '#8b5cf6',
backgroundColor: 'rgba(139, 92, 246, 0.1)',
borderWidth: 2,
fill: true,
tension: 0.1,
pointRadius: 2
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
scales: {
x: { grid: { color: 'transparent' }, ticks: { color: textColor } },
y: { grid: { color: gridColor }, ticks: { color: textColor } }
},
plugins: { legend: { display: false } }
}
});
const ctxWinrate = document.getElementById('winrateChart').getContext('2d');
if (winrateChartInstance) winrateChartInstance.destroy();
const total = winCount + lossCount;
const winRate = total === 0 ? 0 : Math.round((winCount / total) * 100);
document.getElementById('winrate-text').textContent = `${winRate}%`;
winrateChartInstance = new Chart(ctxWinrate, {
type: 'doughnut',
data: {
labels: ['Profit', 'Loss'],
datasets: [{
data: [winCount, lossCount],
backgroundColor: ['#10B981', '#EF4444'],
borderWidth: 0,
hoverOffset: 4
}]
},
options: {
responsive: true,
cutout: '70%',
plugins: {
legend: { position: 'bottom', labels: { color: textColor } }
}
}
});
};

// --- INTERFACE & RENDERING ---
const initApp = () => {
loadData();
migrateOldData();
renderCalendar();
displayDealsForSelectedDate();
updateAnalytics();
};

const renderCalendar = () => {
const calendarGrid = document.getElementById('calendar-grid');
const monthTitle = document.getElementById('current-month-year');
calendarGrid.innerHTML = '';
monthTitle.textContent = `${MONTHS_RU[currentMonth]} ${currentYear}`;
const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
let firstDayIndex = (new Date(currentYear, currentMonth, 1).getDay() + 6) % 7;
DAYS_OF_WEEK_RU.forEach(day => {
const dayName = document.createElement('div');
dayName.className = 'text-center font-bold text-xs text-gray-500 dark:text-gray-400 p-1 uppercase';
dayName.textContent = day;
calendarGrid.appendChild(dayName);
});
for (let i = 0; i < firstDayIndex; i++) {
const paddingDay = document.createElement('div');
paddingDay.className = 'p-2 bg-transparent';
calendarGrid.appendChild(paddingDay);
}
const todayStr = formatDate(new Date());
const selectedDateStr = formatDate(selectedDate);
for (let day = 1; day <= daysInMonth; day++) {
const date = new Date(currentYear, currentMonth, day);
const dateStr = formatDate(date);
const dayDeals = dealsData[dateStr] || [];
let dayPnL = 0;
dayDeals.forEach(d => {
dayPnL += d.type === 'profit' ? parseFloat(d.amount) : -parseFloat(d.amount);
});
const dayElement = document.createElement('div');

let bgClass = 'bg-white dark:bg-darkCard hover:bg-gray-50 dark:hover:bg-gray-700';
let textClass = 'text-gray-700 dark:text-gray-300';
let borderClass = 'border border-gray-100 dark:border-darkBorder';
if (dayDeals.length > 0) {
if (dayPnL > 0) {
bgClass = 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-900';
textClass = 'text-green-800 dark:text-green-400 font-medium';
} else if (dayPnL < 0) {
bgClass = 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-900';
textClass = 'text-red-800 dark:text-red-400 font-medium';
}
}
if (dateStr === selectedDateStr) {
bgClass = 'bg-purple-600 dark:bg-purple-600 !border-purple-600 shadow-md ring-2 ring-purple-300 dark:ring-purple-900';
textClass = 'text-white font-bold';
} else if (dateStr === todayStr) {
borderClass = 'border-2 border-blue-400 dark:border-blue-500';
}
dayElement.className = `p-1 h-20 md:h-24 rounded-xl cursor-pointer transition-all duration-200 flex flex-col justify-between items-start ${bgClass} ${textClass} ${borderClass}`;

const numSpan = document.createElement('span');
numSpan.textContent = day;
numSpan.className = 'text-sm p-1 ml-1';
dayElement.appendChild(numSpan);
if (dayDeals.length > 0) {
const pnlDiv = document.createElement('div');
pnlDiv.className = 'w-full text-center text-xs md:text-sm truncate px-1';
pnlDiv.textContent = (dayPnL > 0 ? '+' : '') + dayPnL.toFixed(0);
if (dateStr !== selectedDateStr) {
pnlDiv.classList.add(dayPnL >= 0 ? 'text-green-600' : 'text-red-600', 'dark:text-current');
}
dayElement.appendChild(pnlDiv);
}
dayElement.onclick = () => selectDate(date);
calendarGrid.appendChild(dayElement);
}
};

const navigateMonth = (direction) => {
currentMonth += direction;
if (currentMonth < 0) { currentMonth = 11; currentYear--; }
else if (currentMonth > 11) { currentMonth = 0; currentYear++; }

const daysInNewMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
let newDay = selectedDate.getDate();
if (newDay > daysInNewMonth) newDay = daysInNewMonth;

selectDate(new Date(currentYear, currentMonth, newDay));
};

const selectDate = (date) => {
selectedDate = date;
currentYear = date.getFullYear();
currentMonth = date.getMonth();
renderCalendar();
displayDealsForSelectedDate();
resetForm();
};

// --- FORM & LIST ---
const resetForm = () => {
document.getElementById('deal-instrument').value = '';
document.getElementById('deal-amount').value = '';
document.getElementById('deal-description').value = '';
document.getElementById('deal-risk').value = '';
document.getElementById('deal-reward').value = '';
document.getElementById('deal-screenshot').value = '';
document.getElementById('deal-strategy').value = '';
document.getElementById('deal-emotion').value = '';

document.getElementById('rr-display').textContent = '-';

document.querySelector('input[name="deal-type"][value="profit"]').checked = true;
document.querySelector('input[name="deal-direction"][value="long"]').checked = true;
editingDealId = null;
document.getElementById('save-deal-btn').textContent = 'Save Trade';
document.getElementById('cancel-edit-btn').classList.add('hidden');
};

window.startEditDeal = (deal) => {
editingDealId = deal.id;
document.getElementById('save-deal-btn').textContent = 'Update Trade';
document.getElementById('cancel-edit-btn').classList.remove('hidden');
document.getElementById('deal-instrument').value = deal.instrument;
document.getElementById('deal-amount').value = deal.amount;
document.getElementById('deal-description').value = deal.description || '';
document.getElementById('deal-risk').value = deal.risk || '';
document.getElementById('deal-reward').value = deal.reward || '';
document.getElementById('deal-screenshot').value = deal.screenshot || '';
document.getElementById('deal-strategy').value = deal.strategy || '';
document.getElementById('deal-emotion').value = deal.emotion || '';
try {
document.querySelector(`input[name="deal-type"][value="${deal.type}"]`).checked = true;
document.querySelector(`input[name="deal-direction"][value="${deal.direction}"]`).checked = true;
} catch(e) {}
calculateRR();
document.getElementById('deal-form-card').scrollIntoView({ behavior: 'smooth' });
};

window.deleteDeal = (dealId) => {
const dateStr = formatDate(selectedDate);
if (confirm('Delete this trade?')) {
dealsData[dateStr] = dealsData[dateStr].filter(d => d.id !== dealId);
if (dealsData[dateStr].length === 0) delete dealsData[dateStr];
saveData();
renderCalendar();
displayDealsForSelectedDate();
}
};

const saveDeal = () => {
const instrument = document.getElementById('deal-instrument').value.trim();
const amount = parseFloat(document.getElementById('deal-amount').value);

if (!instrument || isNaN(amount) || amount < 0) {
showTemporaryMessage('Fill Ticker and Amount (number > 0)', 'red');
return;
}
const dealData = {
instrument,
amount,
type: document.querySelector('input[name="deal-type"]:checked').value,
direction: document.querySelector('input[name="deal-direction"]:checked').value,
description: document.getElementById('deal-description').value.trim(),
risk: parseFloat(document.getElementById('deal-risk').value) || 0,
reward: parseFloat(document.getElementById('deal-reward').value) || 0,
screenshot: document.getElementById('deal-screenshot').value.trim(),
strategy: document.getElementById('deal-strategy').value,
emotion: document.getElementById('deal-emotion').value,
date: formatDate(selectedDate)
};
const dateStr = dealData.date;
if (editingDealId) {
const idx = dealsData[dateStr].findIndex(d => d.id === editingDealId);
if (idx !== -1) {
dealsData[dateStr][idx] = { ...dealsData[dateStr][idx], ...dealData };
showTemporaryMessage('Trade updated!', 'green');
}
} else {
if (!dealsData[dateStr]) dealsData[dateStr] = [];
dealsData[dateStr].push({ ...dealData, id: generateId(), timestamp: new Date().toISOString() });
showTemporaryMessage('Trade added!', 'green');
}
saveData();
renderCalendar();
displayDealsForSelectedDate();
resetForm();
};

const displayDealsForSelectedDate = () => {
const listEl = document.getElementById('deal-list');
const dateStr = formatDate(selectedDate);
const deals = dealsData[dateStr] || [];

document.getElementById('selected-date-display').textContent = new Date(selectedDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
let html = '';
let dailyPnL = 0;
if (deals.length > 0) {
deals.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

deals.forEach(deal => {
const isProfit = deal.type === 'profit';
const amountVal = parseFloat(deal.amount);
dailyPnL += isProfit ? amountVal : -amountVal;
const colorClass = isProfit ? 'border-green-500' : 'border-red-500';
const amountClass = isProfit ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400';
const sign = isProfit ? '+' : '-';

const strategyBadge = deal.strategy ? `<span class="px-2 py-0.5 rounded text-xs bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 mr-2">#${deal.strategy}</span>` : '';
const emotionBadge = deal.emotion ? `<span class="px-2 py-0.5 rounded text-xs bg-indigo-100 dark:bg-indigo-900/40 text-indigo-700 dark:text-indigo-300"> ðŸ˜©  ${deal.emotion}</span>` : '';
const screenshotLink = deal.screenshot ? `<a href="${deal.screenshot}" target="_blank" class="text-blue-500 hover:underline text-xs ml-auto flex items-center"> ðŸ“·  Screenshot</a>` : '';
const dealJson = JSON.stringify(deal).replace(/"/g, '&quot;');
html += `
<div class="bg-white dark:bg-darkCard p-4 rounded-lg shadow-sm border-l-4 ${colorClass} mb-3 group relative hover:shadow-md transition">
<div class="flex justify-between items-start mb-2">
<div>
<div class="flex items-center gap-2">
<span class="font-bold text-lg dark:text-white">${deal.instrument}</span>
<span class="text-xs px-2 py-0.5 rounded ${deal.direction === 'long' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' : 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200'} font-medium uppercase">${deal.direction}</span>
</div>
<div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
R:R: ${deal.risk && deal.reward ? '1:'+(deal.reward/deal.risk).toFixed(1) : '-'} | Risk: $${deal.risk || 0}
</div>
</div>
<div class="text-right">
<div class="font-bold text-xl ${amountClass}">${sign}$${amountVal.toFixed(2)}</div>
</div>
</div>
<div class="flex flex-wrap items-center mt-2 mb-2">
${strategyBadge}
${emotionBadge}
${screenshotLink}
</div>

${deal.description ? `<p class="text-sm text-gray-600 dark:text-gray-400 border-t dark:border-gray-700 pt-2 mt-2 italic">"${deal.description}"</p>` : ''}
<div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex space-x-1 bg-white dark:bg-darkCard pl-2 rounded">
<button onclick="startEditDeal(${dealJson})" class="p-1 text-gray-400 hover:text-blue-500"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg></button>
<button onclick="deleteDeal('${deal.id}')" class="p-1 text-gray-400 hover:text-red-500"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
</div>
</div>
`;
});
} else {
html = `<div class="text-center py-8 text-gray-400 dark:text-gray-600">
<svg class="w-12 h-12 mx-auto mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
<p>No trades for this day</p>
</div>`;
}
document.getElementById('daily-pnl').textContent = `${dailyPnL > 0 ? '+' : ''}${dailyPnL.toFixed(2)}`;
document.getElementById('daily-pnl').className = `text-2xl font-bold ${dailyPnL >= 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`;

listEl.innerHTML = html;
};

const showTemporaryMessage = (msg, type) => {
const el = document.getElementById('toast-msg');
el.textContent = msg;
el.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-xl text-white transform transition-all duration-300 translate-y-0 z-50 ${type === 'green' ?
'bg-green-600' : 'bg-red-600'}`;
setTimeout(() => el.classList.add('translate-y-20'), 3000);
setTimeout(() => el.classList.remove('translate-y-20'), 100);
};

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
initTheme();
initApp();
document.getElementById('theme-toggle').onclick = toggleTheme;
document.getElementById('prev-month').onclick = () => navigateMonth(-1);
document.getElementById('next-month').onclick = () => navigateMonth(1);
document.getElementById('save-deal-btn').onclick = saveDeal;
document.getElementById('cancel-edit-btn').onclick = resetForm;

document.getElementById('deal-risk').oninput = calculateRR;
document.getElementById('deal-reward').oninput = calculateRR;

document.getElementById('export-btn').onclick = exportToCSV;
document.getElementById('backup-btn').onclick = exportBackupJSON;
document.getElementById('import-input').onchange = importBackup;
});
</script>
<style>
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
.no-scrollbar::-webkit-scrollbar { display: none; }
</style>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-darkBg dark:text-darkText transition-colors duration-200 min-h-screen font-sans">
<nav class="bg-white dark:bg-darkCard shadow-sm sticky top-0 z-30">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between h-16 items-center">
<div class="flex items-center gap-2">
<div class="bg-purple-600 text-white p-1.5 rounded-lg">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
</div>
<span class="text-xl font-extrabold tracking-tight dark:text-white">Tradelog<span class="text-purple-600">Pro</span></span>
</div>
<div class="flex items-center gap-3">
<button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 transition" title="Toggle Theme">
<svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
<svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg>
</button>
<div class="h-6 w-px bg-gray-200 dark:bg-gray-700 mx-1"></div>
<button id="export-btn" class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-purple-600 transition hidden md:block">Export CSV</button>
<div class="relative group">
<button class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-purple-600 transition flex items-center gap-1">
Data
<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
</button>
<div class="absolute right-0 mt-2 w-48 bg-white dark:bg-darkCard rounded-md shadow-lg py-1 hidden group-hover:block border border-gray-100 dark:border-darkBorder z-50">
<button id="backup-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Download Backup (JSON)</button>
<label class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer">
Restore (JSON)
<input type="file" id="import-input" accept=".json" class="hidden">
</label>
</div>
</div>
</div>
</div>
</div>
</nav>
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
<div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

<div class="lg:col-span-8 space-y-8">
<div class="bg-white dark:bg-darkCard rounded-2xl shadow-sm border border-gray-100 dark:border-darkBorder p-6">
<div class="flex justify-between items-center mb-6">
<h2 id="current-month-year" class="text-2xl font-bold text-gray-800 dark:text-white capitalize"></h2>
<div class="flex space-x-2">
<button id="prev-month" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
<svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
</button>
<button id="next-month" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
<svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
</button>
</div>
</div>
<div id="calendar-grid" class="grid grid-cols-7 gap-2 sm:gap-4"></div>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="bg-white dark:bg-darkCard rounded-2xl shadow-sm border border-gray-100 dark:border-darkBorder p-6 h-80">
<h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">Equity Curve</h3>
<div class="relative h-60 w-full">
<canvas id="equityChart"></canvas>
</div>
</div>
<div class="bg-white dark:bg-darkCard rounded-2xl shadow-sm border border-gray-100 dark:border-darkBorder p-6 h-80 flex flex-col items-center">
<h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2 self-start w-full">Winrate</h3>
<div class="relative h-56 w-56 mt-2">
<canvas id="winrateChart"></canvas>
<div class="absolute inset-0 flex items-center justify-center pointer-events-none">
<span id="winrate-text" class="text-3xl font-bold text-gray-800 dark:text-white">0%</span>
</div>
</div>
</div>
</div>
</div>

<div class="lg:col-span-4 space-y-6">
<div class="bg-white dark:bg-darkCard p-5 rounded-2xl shadow-sm border border-gray-100 dark:border-darkBorder flex justify-between items-center">
<div>
<p class="text-sm text-gray-500 dark:text-gray-400 uppercase font-semibold tracking-wider">Daily Net PnL</p>
<p id="selected-date-display" class="text-xs text-gray-400 dark:text-gray-500 mt-1">Today</p>
</div>
<div id="daily-pnl" class="text-2xl font-bold text-gray-800 dark:text-white">$0.00</div>
</div>
<div id="deal-form-card" class="bg-white dark:bg-darkCard p-6 rounded-2xl shadow-lg border border-purple-100 dark:border-purple-900/30">
<h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4 border-b border-gray-100 dark:border-gray-700 pb-2">New Trade</h3>
<div class="space-y-4">
<div class="grid grid-cols-2 gap-3">
<div>
<label class="block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1">Ticker</label>
<input type="text" id="deal-instrument" placeholder="BTC" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-purple-500 outline-none dark:text-white transition">
</div>
<div>
<label class="block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1">Result ($)</label>
<input type="number" id="deal-amount" placeholder="0.00" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-purple-500 outline-none dark:text-white transition">
</div>
</div>
<div class="grid grid-cols-2 gap-3">
<div class="bg-gray-50 dark:bg-gray-800 p-2 rounded-lg flex justify-between">
<label class="cursor-pointer flex items-center gap-1">
<input type="radio" name="deal-type" value="profit" class="accent-green-500" checked>
<span class="text-xs font-bold text-green-600 dark:text-green-400">Profit</span>
</label>
<label class="cursor-pointer flex items-center gap-1">
<input type="radio" name="deal-type" value="loss" class="accent-red-500">
<span class="text-xs font-bold text-red-600 dark:text-red-400">Loss</span>
</label>
</div>
<div class="bg-gray-50 dark:bg-gray-800 p-2 rounded-lg flex justify-between">
<label class="cursor-pointer flex items-center gap-1">
<input type="radio" name="deal-direction" value="long" class="accent-blue-500" checked>
<span class="text-xs font-bold text-blue-600 dark:text-blue-400">Long</span>
</label>
<label class="cursor-pointer flex items-center gap-1">
<input type="radio" name="deal-direction" value="short" class="accent-indigo-500">
<span class="text-xs font-bold text-indigo-600 dark:text-indigo-400">Short</span>
</label>
</div>
</div>
<div class="grid grid-cols-2 gap-3 relative">
<div>
<label class="block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1">Risk ($)</label>
<input type="number" id="deal-risk" placeholder="Stop Loss $" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-2.5 text-xs outline-none dark:text-white">
</div>
<div>
<label class="block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1">Reward ($)</label>
<input type="number" id="deal-reward" placeholder="Take Profit $" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-2.5 text-xs outline-none dark:text-white">
</div>
<div class="absolute -top-1 right-0 text-[10px] text-gray-400 bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded">R:R <span id="rr-display">-</span></div>
</div>
<div class="grid grid-cols-2 gap-3">
<div>
<label class="block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1">Strategy</label>
<select id="deal-strategy" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-2 text-xs outline-none dark:text-white">
<option value="">Select...</option>
<option value="breakout">Breakout</option>
<option value="bounce">Bounce</option>
<option value="trend">Trend Following</option>
<option value="counter">Counter-trend</option>
<option value="fakeout">Fakeout</option>
<option value="scalp">Scalping</option>
</select>
</div>
<div>
<label class="block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1">Emotion</label>
<select id="deal-emotion" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-2 text-xs outline-none dark:text-white">
<option value="">Select...</option>
<option value="calm">Calm</option>
<option value="fear">Fear/FOMO</option>
<option value="greed">Greed</option>
<option value="bored">Boredom</option>
<option value="revenge">Revenge (Tilt)</option>
</select>
</div>
</div>
<div>
<label class="block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1">Screenshot (URL)</label>
<input type="url" id="deal-screenshot" placeholder="https://tradingview.com/..." class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-2.5 text-xs outline-none dark:text-white">
</div>
<div>
<textarea id="deal-description" placeholder="Entry reason? Mistakes?" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 text-sm focus:ring-2 focus:ring-purple-500 outline-none dark:text-white resize-none h-20"></textarea>
</div>
<div class="flex gap-2 pt-2">
<button id="save-deal-btn" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-purple-500/30 text-sm">Save Trade</button>
<button id="cancel-edit-btn" class="hidden px-4 bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold py-3 rounded-xl hover:bg-gray-300 dark:hover:bg-gray-600 transition text-sm">X</button>
</div>
</div>
</div>
<div id="deal-list" class="space-y-3 pb-8"></div>
</div>
</div>
</main>
<div id="toast-msg" class="translate-y-20 fixed bottom-4 right-4 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-xl transition-transform duration-300 z-50"></div>
</body>
</html>
